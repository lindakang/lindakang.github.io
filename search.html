---
layout: default
title: Search Results
permalink: /search/
---

<div class="search-page">
    
    <header style="margin-bottom: 30px;">
        <h1 style="color: #5d6eb3; font-weight: bold; font-size: 2rem; margin-bottom: 10px;">Search Results</h1>
        <p id="search-meta" style="color: #666; font-size: 1.1rem;">
            Searching...
        </p>
        <hr style="border: 0; border-top: 1px solid #eee; margin-top: 20px;">
    </header>
    
    <div id="search-results-container" class="post-cards-container">
        </div>

</div>

<script>
window.onload = function() {
    var urlParams = new URLSearchParams(window.location.search);
    var query = urlParams.get('q');
    
    if (query) {
        var lowerQuery = query.toLowerCase();

        fetch('{{ "/search.json" | relative_url }}')
            .then(response => response.json())
            .then(data => {
                var results = [];
                data.forEach(function(item) {
                    // 搜尋邏輯：比對標題、標籤、分類、摘要
                    if (
                        (item.title && item.title.toLowerCase().includes(lowerQuery)) ||
                        (item.tags && item.tags.toLowerCase().includes(lowerQuery)) ||
                        (item.category && item.category.toLowerCase().includes(lowerQuery)) ||
                        (item.excerpt && item.excerpt.toLowerCase().includes(lowerQuery))
                    ) {
                        results.push(item);
                    }
                });
                
                // 更新標題資訊
                updateSearchMeta(results.length, query);
                // 顯示卡片
                displayResults(results);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('search-results-container').innerHTML = '<p>Search is currently unavailable.</p>';
            });
    } else {
        document.getElementById('search-meta').innerText = "Please enter a keyword.";
    }
};

function updateSearchMeta(count, term) {
    var metaText = `Found ${count} result(s) for "${term}"`;
    document.getElementById('search-meta').innerText = metaText;
}

function displayResults(results) {
    var container = document.getElementById('search-results-container');
    container.innerHTML = '';

    if (results.length === 0) {
        container.innerHTML = '<p style="color:#666; padding:20px 0;">No results found.</p>';
        return;
    }

    var html = '';
    results.forEach(function(post) {
        // 處理 Tags：把字串 "tag1, tag2" 切割成藍色小按鈕 HTML
        var tagsHtml = '';
        if (post.tags) {
            var tagsArray = post.tags.split(', '); // 假設 search.json 用逗號空格分隔
            tagsHtml = '<div class="post-card-tags" style="margin-top:15px;">';
            tagsArray.forEach(function(tag){
                // 為了安全去掉多餘空白
                tag = tag.trim(); 
                if(tag) {
                    tagsHtml += `<span class="tag-pill-blue">${tag}</span>`;
                }
            });
            tagsHtml += '</div>';
        }

        // 產生卡片 HTML (完全複製你分類頁面的結構)
        html += `
        <article class="post-card">
            <h3 class="post-card-title">
                <a href="${post.url}">${post.title}</a>
            </h3>
            
            <div class="post-card-meta">
                <span>${post.date}</span> 
                &nbsp;•&nbsp; 
                <span>${post.category}</span>
            </div>

            <div class="post-card-excerpt">
                ${post.excerpt} ...
            </div>

            ${tagsHtml}
        </article>
        `;
    });

    container.innerHTML = html;
}
</script>
